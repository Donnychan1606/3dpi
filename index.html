<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
	<title>3DPI Scene</title>
	<style>
		body {
			margin: 0;
			overflow: hidden;
		}
	</style>
	<script src="./build/three2.js"></script>
	<script src="./build/ar2.js"></script>
	<script type='text/javascript'>
		var scan_or_show = 0;
		var ball_1D0, ball_1D1, ball_1D2, C_y0, C_z0, C_y1, C_z1, C_y2, C_z2;
		var resolution = new THREE.Vector2(window.innerWidth, window.innerHeight / 2);
		var P1new, P2new, Tnew;
		var loader = new THREE.FontLoader();
	</script>
	<script src="./build/jsQR.js"></script>
	<script src="./build/OrbitControls2.js"></script>
	<script src="./build/THREE.MeshLine.js"></script>
	<script src="./create_model_jshaman2.js"></script>
	<script src="./jsQR_worker.js"></script>
</head>

<body>
	<div id="text" style='position: absolute; bottom: 10px; width:100%; text-align: center; z-index: 1;'>
		<p id="debug" style="color: red; font-size: 25px;"><strong>It is recommended to use portrait mode and scan each QR code in turn. </strong></p>
		<a onclick="sAlert('effect');">The list of currently tested devices (click to view)</a>
	</div>
	<canvas id="canvas"></canvas>
	<img id="source1" width="150" height="150">
	<img id="source2" width="150" height="150">
	<img id="source3" width="150" height="150">
	<script>
		let param = window.location.search.substring(1);
		// console.log(param);
		function sAlert(str) {
			var msgw, msgh, bordercolor;
			msgw = 400;
			msgh = 800;
			titleheight = 10
			bordercolor = "#336699";
			titlecolor = "#99CCFF";
			var sWidth, sHeight;
			sWidth = document.body.offsetWidth;
			sHeight = screen.height;
			var bgObj = document.createElement("div");
			bgObj.setAttribute('id', 'bgDiv');
			bgObj.style.position = "absolute";
			bgObj.style.top = "0";
			bgObj.style.filter = "progid:DXImageTransform.Microsoft.Alpha(style=3,opacity=25,finishOpacity=75";
			bgObj.style.opacity = "0.6";
			bgObj.style.left = "0";
			bgObj.style.width = sWidth + "px";
			bgObj.style.height = sHeight + "px";
			bgObj.style.zIndex = "10000";
			document.body.appendChild(bgObj);
			var msgObj = document.createElement("div")
			msgObj.setAttribute("id", "msgDiv");
			msgObj.setAttribute("align", "center");
			msgObj.style.background = "white";
			msgObj.style.border = "1px solid " + bordercolor;
			msgObj.style.position = "absolute";
			msgObj.style.left = "50%";
			msgObj.style.top = "50%";
			msgObj.style.font = "12px/1.6em Verdana, Geneva, Arial, Helvetica, sans-serif";
			msgObj.style.marginLeft = "-225px";
			msgObj.style.marginTop = -400 + document.documentElement.scrollTop + "px";
			msgObj.style.width = msgw + "px";
			msgObj.style.height = msgh + "px";
			msgObj.style.textAlign = "center";
			msgObj.style.lineHeight = "15px";
			msgObj.style.zIndex = "10001";
			var title = document.createElement("h4");
			title.setAttribute("id", "msgTitle");
			title.setAttribute("align", "right");
			title.style.margin = "0";
			title.style.padding = "3px";
			title.style.background = bordercolor;
			title.style.filter = "progid:DXImageTransform.Microsoft.Alpha(startX=20, startY=20, finishX=100, finishY=100,style=1,opacity=75,finishOpacity=100);";
			title.style.opacity = "0.75";
			title.style.border = "1px solid " + bordercolor;
			title.style.height = "58px";
			title.style.font = "12px Verdana, Geneva, Arial, Helvetica, sans-serif";
			title.style.color = "white";
			title.style.cursor = "pointer";
			title.innerHTML = "close";
			title.onclick = function () {
				document.body.removeChild(bgObj);
				document.getElementById("msgDiv").removeChild(title);
				document.body.removeChild(msgObj);
			}
			document.body.appendChild(msgObj);
			document.getElementById("msgDiv").appendChild(title);
			var txt = document.createElement("p");
			txt.style.margin = "1em 0"
			txt.setAttribute("id", "msgTxt");
			txt.innerHTML = "<span style='color:red;'>Update date: May 17, 2022</span><strong><span style='font-size:15px;'><br>Apple:<br></span></strong>all models after iPhone 5s<br><span style='font-size:10px; color:red;'>Models before 7th generation may experience slight lag</span>";
			txt.innerHTML += "<strong><span style='font-size:15px;'><br><br>Xiaomi and Redmi: <br></span></strong>Xiaomi 10 Fail<br>Xiaomi 10Luxury Edition Pass<br>Xiaomi 11 Pass<br>Xiaomi 11pro Pass<br>Xiaomi 10s Pass<br>Xiaomi 11Youth Edition Pass<br>Redmi 10x Pass<br>Redmi k30 Pass<br>Redmi Note9 Pass<br>Redmi note8 Pass<br>Redmi k40pro Pass<br>Redmi k40 Pass<br>Redmi k30 Pass<br>Redmi k30s Pass<br><br><strong><span style='font-size:15px;'>Huawei and Honor:<br></span></strong>";
			txt.innerHTML += "<span style='font-size:10px; color:red;'>certain models in the Huawei p series, Mate series and Honor, due to camera protocol issues, may cause overly long focal length and slow focusing, affecting scanning speed</span><br>Mate40 camera zoom issues<br>Mate40rs Pass<br>p40 Fail<br>Mate30 Pass <br>P30pro camera zoom issues<br>p20 camera zoom issues<br>nova7 Pass<br>nova7p Pass<br>nova8 Pass<br>nova8pro Pass<br>Changxiang20pro Pass<br>Changxiang20plus Pass<br>Changxiang20se Pass<br>Honor 30s camera zoom issues<br>Honor 30 Pass<br>Honor v40Luxury Edition Pass<br>Honor v40 Pass<br><br><strong><span style='font-size:15px;'>vivo:</span></strong><br>vivo y30 Pass<br>vivo s9 Pass<br>vivo x60pro Pass<br>Vivo IQoo7 Pass";
			document.getElementById("msgDiv").appendChild(txt);
		}
		window.mobileCheck = function () {
			let check = false;
			(function (a) { if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);
			return check;
		};
		var isMobile = window.mobileCheck();
		if (typeof window.orientation == 'undefined') { 
			isMobile = false;
		}
		if (isMobile == false) {
		//	window.location.href = "./mountain/index.html";
		}
		var geometry_array = new Array(3);
		var total_frames = [1, 1, 1];
		let size = 10, segmentX = 50 / 2, segmentY = 18;
		function create_empty_geometry(num_model) {
			geometry_array[num_model] = [];
			for (let a = 0; a < 100; a++) {
				geometry_array[num_model][a] = new THREE.PlaneGeometry(size, size * segmentX / segmentY, segmentY - 1, segmentX - 1);
			}
		}
		create_empty_geometry(0);
		create_empty_geometry(1);
		create_empty_geometry(2);
		var scene = new THREE.Scene();
		var width = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
		var height = Math.max(document.documentElement.clientHeight, window.innerHeight || 0)
		var zFactor = height / width * 0.6;
		var s = 20;
		// camera = new THREE.Camera();
		camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
		// camera.position.set( 4, 2, 0 );
		scene.add(camera);
		var point = new THREE.PointLight(0xffffff);
		point.position.set(400, 200, 300);
		scene.add(point);
		var ambient = new THREE.AmbientLight(0x444444);
		scene.add(ambient);
		canvas = document.getElementById("canvas");
		var renderer = new THREE.WebGLRenderer({
			antialias: true,
			alpha: true,
			canvas: canvas
		});
		var devicePixelRatio = window.devicePixelRatio;
		renderer.setPixelRatio(devicePixelRatio);
		renderer.setClearColor(new THREE.Color('lightgrey'), 0)
		renderer.setSize(640, 480);
		renderer.domElement.style.position = 'absolute'
		renderer.domElement.style.top = '0px'
		renderer.domElement.style.left = '0px'
		function render() {
			renderer.render(scene, camera);
		}
		render();
		// add gesture control 
		const controls = new THREE.OrbitControls(camera, renderer.domElement);
		controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
		controls.dampingFactor = 0.05;
		controls.screenSpacePanning = false;
		// controls.autoRotate = true;
		// controls.minDistance = 40;
		// controls.maxDistance = 500;
		controls.maxPolarAngle = Math.PI / 2;
		// controls.maxPolarAngle = 0;
		controls.update();
		function onWindowResize() {
			camera.aspect = Math.max(document.documentElement.clientWidth, window.innerWidth || 0) / Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
			camera.updateProjectionMatrix();
			render.setSize(Math.max(document.documentElement.clientWidth, window.innerWidth || 0), Math.max(document.documentElement.clientHeight, window.innerHeight || 0));
			controls.update();
		}
		var onRenderFcts = [];
		var barcode_group = [0, 0, 0];
		var arToolkitSource = new THREEx.ArToolkitSource({
			sourceType: 'webcam',
		})
		arToolkitSource.init(function onReady() {
			setTimeout(() => {
				resize_ok = 1;
			}, 2000);
			if (arToolkitContext.arController !== null) {
				arToolkitContext.arController.setPatternDetectionMode(artoolkit.AR_MATRIX_CODE_DETECTION);
				arToolkitContext.arController.setMatrixCodeType(artoolkit.AR_MATRIX_CODE_4x4);
			}
		})
		window.addEventListener('resize', function () {
			onResize()
		})
		function onResize() {
			arToolkitSource.onResizeElement()
			arToolkitSource.copyElementSizeTo(renderer.domElement)
			if (arToolkitContext.arController !== null) {
				arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas)
			}
		}
		var arToolkitContext = new THREEx.ArToolkitContext({
			cameraParametersUrl: 'camera_para.dat',
			detectionMode: 'mono_and_matrix',
			matrixCodeType: '4x4',
			labelingMode: 'black_region',
		})
		arToolkitContext.init(function onCompleted() {
			camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
			controls.update();
			onResize();
		})
		var resize_ok = 0;
		onRenderFcts.push(function () {
			if (arToolkitContext.arController.canvas.height < 100) { return }
			else if (!resize_ok) {
				onResize();
			} else if (resize_ok) {
				var el = document.getElementById("text");
				el.style.bottom = "10px";
				el.style.textAlign = "center";
			}
			arToolkitContext.update(arToolkitSource.domElement)
		})
		scene.visible = true;
		var group0 = new THREE.Group;
		var group1 = new THREE.Group;
		var group2 = new THREE.Group;
		var num = [1, 1, 1];
		var distance1DPulse = -5;
		var C_y0, C_z0;
		var frame_info, frame_color_info;
		var jet = [[0.000, [0.000, 0.000, 0.500]], [0.002, [0.000, 0.000, 0.500]], [0.004, [0.000, 0.000, 0.518]], [0.006, [0.000, 0.000, 0.518]], [0.008, [0.000, 0.000, 0.536]], [0.010, [0.000, 0.000, 0.536]], [0.012, [0.000, 0.000, 0.553]], [0.014, [0.000, 0.000, 0.553]], [0.016, [0.000, 0.000, 0.571]], [0.018, [0.000, 0.000, 0.571]], [0.020, [0.000, 0.000, 0.589]], [0.022, [0.000, 0.000, 0.589]], [0.023, [0.000, 0.000, 0.607]], [0.025, [0.000, 0.000, 0.607]], [0.027, [0.000, 0.000, 0.625]], [0.029, [0.000, 0.000, 0.625]], [0.031, [0.000, 0.000, 0.643]], [0.033, [0.000, 0.000, 0.643]], [0.035, [0.000, 0.000, 0.660]], [0.037, [0.000, 0.000, 0.660]], [0.039, [0.000, 0.000, 0.678]], [0.041, [0.000, 0.000, 0.678]], [0.043, [0.000, 0.000, 0.696]], [0.045, [0.000, 0.000, 0.696]], [0.047, [0.000, 0.000, 0.714]], [0.049, [0.000, 0.000, 0.714]], [0.051, [0.000, 0.000, 0.732]], [0.053, [0.000, 0.000, 0.732]], [0.055, [0.000, 0.000, 0.750]], [0.057, [0.000, 0.000, 0.750]], [0.059, [0.000, 0.000, 0.767]], [0.061, [0.000, 0.000, 0.767]], [0.063, [0.000, 0.000, 0.785]], [0.065, [0.000, 0.000, 0.785]], [0.067, [0.000, 0.000, 0.803]], [0.068, [0.000, 0.000, 0.803]], [0.070, [0.000, 0.000, 0.821]], [0.072, [0.000, 0.000, 0.821]], [0.074, [0.000, 0.000, 0.839]], [0.076, [0.000, 0.000, 0.839]], [0.078, [0.000, 0.000, 0.857]], [0.080, [0.000, 0.000, 0.857]], [0.082, [0.000, 0.000, 0.874]], [0.084, [0.000, 0.000, 0.874]], [0.086, [0.000, 0.000, 0.892]], [0.088, [0.000, 0.000, 0.892]], [0.090, [0.000, 0.000, 0.910]], [0.092, [0.000, 0.000, 0.910]], [0.094, [0.000, 0.000, 0.928]], [0.096, [0.000, 0.000, 0.928]], [0.098, [0.000, 0.000, 0.946]], [0.100, [0.000, 0.000, 0.946]], [0.102, [0.000, 0.000, 0.963]], [0.104, [0.000, 0.000, 0.963]], [0.106, [0.000, 0.000, 0.981]], [0.108, [0.000, 0.000, 0.981]], [0.110, [0.000, 0.000, 0.999]], [0.112, [0.000, 0.000, 0.999]], [0.114, [0.000, 0.000, 1.000]], [0.115, [0.000, 0.000, 1.000]], [0.117, [0.000, 0.000, 1.000]], [0.119, [0.000, 0.000, 1.000]], [0.121, [0.000, 0.000, 1.000]], [0.123, [0.000, 0.000, 1.000]], [0.125, [0.000, 0.002, 1.000]], [0.127, [0.000, 0.002, 1.000]], [0.129, [0.000, 0.018, 1.000]], [0.131, [0.000, 0.018, 1.000]], [0.133, [0.000, 0.033, 1.000]], [0.135, [0.000, 0.033, 1.000]], [0.137, [0.000, 0.049, 1.000]], [0.139, [0.000, 0.049, 1.000]], [0.141, [0.000, 0.065, 1.000]], [0.143, [0.000, 0.065, 1.000]], [0.145, [0.000, 0.080, 1.000]], [0.147, [0.000, 0.080, 1.000]], [0.149, [0.000, 0.096, 1.000]], [0.151, [0.000, 0.096, 1.000]], [0.153, [0.000, 0.112, 1.000]], [0.155, [0.000, 0.112, 1.000]], [0.157, [0.000, 0.127, 1.000]], [0.159, [0.000, 0.127, 1.000]], [0.160, [0.000, 0.143, 1.000]], [0.162, [0.000, 0.143, 1.000]], [0.164, [0.000, 0.159, 1.000]], [0.166, [0.000, 0.159, 1.000]], [0.168, [0.000, 0.175, 1.000]], [0.170, [0.000, 0.175, 1.000]], [0.172, [0.000, 0.190, 1.000]], [0.174, [0.000, 0.190, 1.000]], [0.176, [0.000, 0.206, 1.000]], [0.178, [0.000, 0.206, 1.000]], [0.180, [0.000, 0.222, 1.000]], [0.182, [0.000, 0.222, 1.000]], [0.184, [0.000, 0.237, 1.000]], [0.186, [0.000, 0.237, 1.000]], [0.188, [0.000, 0.253, 1.000]], [0.190, [0.000, 0.253, 1.000]], [0.192, [0.000, 0.269, 1.000]], [0.194, [0.000, 0.269, 1.000]], [0.196, [0.000, 0.284, 1.000]], [0.198, [0.000, 0.284, 1.000]], [0.200, [0.000, 0.300, 1.000]], [0.202, [0.000, 0.300, 1.000]], [0.204, [0.000, 0.316, 1.000]], [0.205, [0.000, 0.316, 1.000]], [0.207, [0.000, 0.331, 1.000]], [0.209, [0.000, 0.331, 1.000]], [0.211, [0.000, 0.347, 1.000]], [0.213, [0.000, 0.347, 1.000]], [0.215, [0.000, 0.363, 1.000]], [0.217, [0.000, 0.363, 1.000]], [0.219, [0.000, 0.378, 1.000]], [0.221, [0.000, 0.378, 1.000]], [0.223, [0.000, 0.394, 1.000]], [0.225, [0.000, 0.394, 1.000]], [0.227, [0.000, 0.410, 1.000]], [0.229, [0.000, 0.410, 1.000]], [0.231, [0.000, 0.425, 1.000]], [0.233, [0.000, 0.425, 1.000]], [0.235, [0.000, 0.441, 1.000]], [0.237, [0.000, 0.441, 1.000]], [0.239, [0.000, 0.457, 1.000]], [0.241, [0.000, 0.457, 1.000]], [0.243, [0.000, 0.473, 1.000]], [0.245, [0.000, 0.473, 1.000]], [0.247, [0.000, 0.488, 1.000]], [0.249, [0.000, 0.488, 1.000]], [0.250, [0.000, 0.504, 1.000]], [0.252, [0.000, 0.504, 1.000]], [0.254, [0.000, 0.520, 1.000]], [0.256, [0.000, 0.520, 1.000]], [0.258, [0.000, 0.535, 1.000]], [0.260, [0.000, 0.535, 1.000]], [0.262, [0.000, 0.551, 1.000]], [0.264, [0.000, 0.551, 1.000]], [0.266, [0.000, 0.567, 1.000]], [0.268, [0.000, 0.567, 1.000]], [0.270, [0.000, 0.582, 1.000]], [0.272, [0.000, 0.582, 1.000]], [0.274, [0.000, 0.598, 1.000]], [0.276, [0.000, 0.598, 1.000]], [0.278, [0.000, 0.614, 1.000]], [0.280, [0.000, 0.614, 1.000]], [0.282, [0.000, 0.629, 1.000]], [0.284, [0.000, 0.629, 1.000]], [0.286, [0.000, 0.645, 1.000]], [0.288, [0.000, 0.645, 1.000]], [0.290, [0.000, 0.661, 1.000]], [0.292, [0.000, 0.661, 1.000]], [0.294, [0.000, 0.676, 1.000]], [0.295, [0.000, 0.676, 1.000]], [0.297, [0.000, 0.692, 1.000]], [0.299, [0.000, 0.692, 1.000]], [0.301, [0.000, 0.708, 1.000]], [0.303, [0.000, 0.708, 1.000]], [0.305, [0.000, 0.724, 1.000]], [0.307, [0.000, 0.724, 1.000]], [0.309, [0.000, 0.739, 1.000]], [0.311, [0.000, 0.739, 1.000]], [0.313, [0.000, 0.755, 1.000]], [0.315, [0.000, 0.755, 1.000]], [0.317, [0.000, 0.771, 1.000]], [0.319, [0.000, 0.771, 1.000]], [0.321, [0.000, 0.786, 1.000]], [0.323, [0.000, 0.786, 1.000]], [0.325, [0.000, 0.802, 1.000]], [0.327, [0.000, 0.802, 1.000]], [0.329, [0.000, 0.818, 1.000]], [0.331, [0.000, 0.818, 1.000]], [0.333, [0.000, 0.833, 1.000]], [0.335, [0.000, 0.833, 1.000]], [0.337, [0.000, 0.849, 1.000]], [0.339, [0.000, 0.849, 1.000]], [0.341, [0.000, 0.865, 0.996]], [0.342, [0.000, 0.865, 0.996]], [0.344, [0.000, 0.880, 0.984]], [0.346, [0.000, 0.880, 0.984]], [0.348, [0.000, 0.896, 0.971]], [0.350, [0.000, 0.896, 0.971]], [0.352, [0.009, 0.912, 0.958]], [0.354, [0.009, 0.912, 0.958]], [0.356, [0.022, 0.927, 0.946]], [0.358, [0.022, 0.927, 0.946]], [0.360, [0.035, 0.943, 0.933]], [0.362, [0.035, 0.943, 0.933]], [0.364, [0.047, 0.959, 0.920]], [0.366, [0.047, 0.959, 0.920]], [0.368, [0.060, 0.975, 0.908]], [0.370, [0.060, 0.975, 0.908]], [0.372, [0.073, 0.990, 0.895]], [0.374, [0.073, 0.990, 0.895]], [0.376, [0.085, 1.000, 0.882]], [0.378, [0.085, 1.000, 0.882]], [0.380, [0.098, 1.000, 0.870]], [0.382, [0.098, 1.000, 0.870]], [0.384, [0.111, 1.000, 0.857]], [0.386, [0.111, 1.000, 0.857]], [0.387, [0.123, 1.000, 0.844]], [0.389, [0.123, 1.000, 0.844]], [0.391, [0.136, 1.000, 0.832]], [0.393, [0.136, 1.000, 0.832]], [0.395, [0.149, 1.000, 0.819]], [0.397, [0.149, 1.000, 0.819]], [0.399, [0.161, 1.000, 0.806]], [0.401, [0.161, 1.000, 0.806]], [0.403, [0.174, 1.000, 0.794]], [0.405, [0.174, 1.000, 0.794]], [0.407, [0.187, 1.000, 0.781]], [0.409, [0.187, 1.000, 0.781]], [0.411, [0.199, 1.000, 0.769]], [0.413, [0.199, 1.000, 0.769]], [0.415, [0.212, 1.000, 0.756]], [0.417, [0.212, 1.000, 0.756]], [0.419, [0.225, 1.000, 0.743]], [0.421, [0.225, 1.000, 0.743]], [0.423, [0.237, 1.000, 0.731]], [0.425, [0.237, 1.000, 0.731]], [0.427, [0.250, 1.000, 0.718]], [0.429, [0.250, 1.000, 0.718]], [0.431, [0.262, 1.000, 0.705]], [0.432, [0.262, 1.000, 0.705]], [0.434, [0.275, 1.000, 0.693]], [0.436, [0.275, 1.000, 0.693]], [0.438, [0.288, 1.000, 0.680]], [0.440, [0.288, 1.000, 0.680]], [0.442, [0.300, 1.000, 0.667]], [0.444, [0.300, 1.000, 0.667]], [0.446, [0.313, 1.000, 0.655]], [0.448, [0.313, 1.000, 0.655]], [0.450, [0.326, 1.000, 0.642]], [0.452, [0.326, 1.000, 0.642]], [0.454, [0.338, 1.000, 0.629]], [0.456, [0.338, 1.000, 0.629]], [0.458, [0.351, 1.000, 0.617]], [0.460, [0.351, 1.000, 0.617]], [0.462, [0.364, 1.000, 0.604]], [0.464, [0.364, 1.000, 0.604]], [0.466, [0.376, 1.000, 0.591]], [0.468, [0.376, 1.000, 0.591]], [0.470, [0.389, 1.000, 0.579]], [0.472, [0.389, 1.000, 0.579]], [0.474, [0.402, 1.000, 0.566]], [0.476, [0.402, 1.000, 0.566]], [0.477, [0.414, 1.000, 0.553]], [0.479, [0.414, 1.000, 0.553]], [0.481, [0.427, 1.000, 0.541]], [0.483, [0.427, 1.000, 0.541]], [0.485, [0.440, 1.000, 0.528]], [0.487, [0.440, 1.000, 0.528]], [0.489, [0.452, 1.000, 0.515]], [0.491, [0.452, 1.000, 0.515]], [0.493, [0.465, 1.000, 0.503]], [0.495, [0.465, 1.000, 0.503]], [0.497, [0.478, 1.000, 0.490]], [0.499, [0.478, 1.000, 0.490]], [0.501, [0.490, 1.000, 0.478]], [0.503, [0.490, 1.000, 0.478]], [0.505, [0.503, 1.000, 0.465]], [0.507, [0.503, 1.000, 0.465]], [0.509, [0.515, 1.000, 0.452]], [0.511, [0.515, 1.000, 0.452]], [0.513, [0.528, 1.000, 0.440]], [0.515, [0.528, 1.000, 0.440]], [0.517, [0.541, 1.000, 0.427]], [0.519, [0.541, 1.000, 0.427]], [0.521, [0.553, 1.000, 0.414]], [0.523, [0.553, 1.000, 0.414]], [0.524, [0.566, 1.000, 0.402]], [0.526, [0.566, 1.000, 0.402]], [0.528, [0.579, 1.000, 0.389]], [0.530, [0.579, 1.000, 0.389]], [0.532, [0.591, 1.000, 0.376]], [0.534, [0.591, 1.000, 0.376]], [0.536, [0.604, 1.000, 0.364]], [0.538, [0.604, 1.000, 0.364]], [0.540, [0.617, 1.000, 0.351]], [0.542, [0.617, 1.000, 0.351]], [0.544, [0.629, 1.000, 0.338]], [0.546, [0.629, 1.000, 0.338]], [0.548, [0.642, 1.000, 0.326]], [0.550, [0.642, 1.000, 0.326]], [0.552, [0.655, 1.000, 0.313]], [0.554, [0.655, 1.000, 0.313]], [0.556, [0.667, 1.000, 0.300]], [0.558, [0.667, 1.000, 0.300]], [0.560, [0.680, 1.000, 0.288]], [0.562, [0.680, 1.000, 0.288]], [0.564, [0.693, 1.000, 0.275]], [0.566, [0.693, 1.000, 0.275]], [0.568, [0.705, 1.000, 0.262]], [0.569, [0.705, 1.000, 0.262]], [0.571, [0.718, 1.000, 0.250]], [0.573, [0.718, 1.000, 0.250]], [0.575, [0.731, 1.000, 0.237]], [0.577, [0.731, 1.000, 0.237]], [0.579, [0.743, 1.000, 0.225]], [0.581, [0.743, 1.000, 0.225]], [0.583, [0.756, 1.000, 0.212]], [0.585, [0.756, 1.000, 0.212]], [0.587, [0.769, 1.000, 0.199]], [0.589, [0.769, 1.000, 0.199]], [0.591, [0.781, 1.000, 0.187]], [0.593, [0.781, 1.000, 0.187]], [0.595, [0.794, 1.000, 0.174]], [0.597, [0.794, 1.000, 0.174]], [0.599, [0.806, 1.000, 0.161]], [0.601, [0.806, 1.000, 0.161]], [0.603, [0.819, 1.000, 0.149]], [0.605, [0.819, 1.000, 0.149]], [0.607, [0.832, 1.000, 0.136]], [0.609, [0.832, 1.000, 0.136]], [0.611, [0.844, 1.000, 0.123]], [0.613, [0.844, 1.000, 0.123]], [0.614, [0.857, 1.000, 0.111]], [0.616, [0.857, 1.000, 0.111]], [0.618, [0.870, 1.000, 0.098]], [0.620, [0.870, 1.000, 0.098]], [0.622, [0.882, 1.000, 0.085]], [0.624, [0.882, 1.000, 0.085]], [0.626, [0.895, 1.000, 0.073]], [0.628, [0.895, 1.000, 0.073]], [0.630, [0.908, 1.000, 0.060]], [0.632, [0.908, 1.000, 0.060]], [0.634, [0.920, 1.000, 0.047]], [0.636, [0.920, 1.000, 0.047]], [0.638, [0.933, 1.000, 0.035]], [0.640, [0.933, 1.000, 0.035]], [0.642, [0.946, 0.988, 0.022]], [0.644, [0.946, 0.988, 0.022]], [0.646, [0.958, 0.974, 0.009]], [0.648, [0.958, 0.974, 0.009]], [0.650, [0.971, 0.959, 0.000]], [0.652, [0.971, 0.959, 0.000]], [0.654, [0.984, 0.945, 0.000]], [0.656, [0.984, 0.945, 0.000]], [0.658, [0.996, 0.930, 0.000]], [0.659, [0.996, 0.930, 0.000]], [0.661, [1.000, 0.916, 0.000]], [0.663, [1.000, 0.916, 0.000]], [0.665, [1.000, 0.901, 0.000]], [0.667, [1.000, 0.901, 0.000]], [0.669, [1.000, 0.887, 0.000]], [0.671, [1.000, 0.887, 0.000]], [0.673, [1.000, 0.872, 0.000]], [0.675, [1.000, 0.872, 0.000]], [0.677, [1.000, 0.858, 0.000]], [0.679, [1.000, 0.858, 0.000]], [0.681, [1.000, 0.843, 0.000]], [0.683, [1.000, 0.843, 0.000]], [0.685, [1.000, 0.829, 0.000]], [0.687, [1.000, 0.829, 0.000]], [0.689, [1.000, 0.814, 0.000]], [0.691, [1.000, 0.814, 0.000]], [0.693, [1.000, 0.800, 0.000]], [0.695, [1.000, 0.800, 0.000]], [0.697, [1.000, 0.785, 0.000]], [0.699, [1.000, 0.785, 0.000]], [0.701, [1.000, 0.771, 0.000]], [0.703, [1.000, 0.771, 0.000]], [0.705, [1.000, 0.756, 0.000]], [0.706, [1.000, 0.756, 0.000]], [0.708, [1.000, 0.741, 0.000]], [0.710, [1.000, 0.741, 0.000]], [0.712, [1.000, 0.727, 0.000]], [0.714, [1.000, 0.727, 0.000]], [0.716, [1.000, 0.712, 0.000]], [0.718, [1.000, 0.712, 0.000]], [0.720, [1.000, 0.698, 0.000]], [0.722, [1.000, 0.698, 0.000]], [0.724, [1.000, 0.683, 0.000]], [0.726, [1.000, 0.683, 0.000]], [0.728, [1.000, 0.669, 0.000]], [0.730, [1.000, 0.669, 0.000]], [0.732, [1.000, 0.654, 0.000]], [0.734, [1.000, 0.654, 0.000]], [0.736, [1.000, 0.640, 0.000]], [0.738, [1.000, 0.640, 0.000]], [0.740, [1.000, 0.625, 0.000]], [0.742, [1.000, 0.625, 0.000]], [0.744, [1.000, 0.611, 0.000]], [0.746, [1.000, 0.611, 0.000]], [0.748, [1.000, 0.596, 0.000]], [0.750, [1.000, 0.596, 0.000]], [0.751, [1.000, 0.582, 0.000]], [0.753, [1.000, 0.582, 0.000]], [0.755, [1.000, 0.567, 0.000]], [0.757, [1.000, 0.567, 0.000]], [0.759, [1.000, 0.553, 0.000]], [0.761, [1.000, 0.553, 0.000]], [0.763, [1.000, 0.538, 0.000]], [0.765, [1.000, 0.538, 0.000]], [0.767, [1.000, 0.524, 0.000]], [0.769, [1.000, 0.524, 0.000]], [0.771, [1.000, 0.509, 0.000]], [0.773, [1.000, 0.509, 0.000]], [0.775, [1.000, 0.495, 0.000]], [0.777, [1.000, 0.495, 0.000]], [0.779, [1.000, 0.480, 0.000]], [0.781, [1.000, 0.480, 0.000]], [0.783, [1.000, 0.466, 0.000]], [0.785, [1.000, 0.466, 0.000]], [0.787, [1.000, 0.451, 0.000]], [0.789, [1.000, 0.451, 0.000]], [0.791, [1.000, 0.436, 0.000]], [0.793, [1.000, 0.436, 0.000]], [0.795, [1.000, 0.422, 0.000]], [0.796, [1.000, 0.422, 0.000]], [0.798, [1.000, 0.407, 0.000]], [0.800, [1.000, 0.407, 0.000]], [0.802, [1.000, 0.393, 0.000]], [0.804, [1.000, 0.393, 0.000]], [0.806, [1.000, 0.378, 0.000]], [0.808, [1.000, 0.378, 0.000]], [0.810, [1.000, 0.364, 0.000]], [0.812, [1.000, 0.364, 0.000]], [0.814, [1.000, 0.349, 0.000]], [0.816, [1.000, 0.349, 0.000]], [0.818, [1.000, 0.335, 0.000]], [0.820, [1.000, 0.335, 0.000]], [0.822, [1.000, 0.320, 0.000]], [0.824, [1.000, 0.320, 0.000]], [0.826, [1.000, 0.306, 0.000]], [0.828, [1.000, 0.306, 0.000]], [0.830, [1.000, 0.291, 0.000]], [0.832, [1.000, 0.291, 0.000]], [0.834, [1.000, 0.277, 0.000]], [0.836, [1.000, 0.277, 0.000]], [0.838, [1.000, 0.262, 0.000]], [0.840, [1.000, 0.262, 0.000]], [0.841, [1.000, 0.248, 0.000]], [0.843, [1.000, 0.248, 0.000]], [0.845, [1.000, 0.233, 0.000]], [0.847, [1.000, 0.233, 0.000]], [0.849, [1.000, 0.219, 0.000]], [0.851, [1.000, 0.219, 0.000]], [0.853, [1.000, 0.204, 0.000]], [0.855, [1.000, 0.204, 0.000]], [0.857, [1.000, 0.190, 0.000]], [0.859, [1.000, 0.190, 0.000]], [0.861, [1.000, 0.175, 0.000]], [0.863, [1.000, 0.175, 0.000]], [0.865, [1.000, 0.160, 0.000]], [0.867, [1.000, 0.160, 0.000]], [0.869, [1.000, 0.146, 0.000]], [0.871, [1.000, 0.146, 0.000]], [0.873, [1.000, 0.131, 0.000]], [0.875, [1.000, 0.131, 0.000]], [0.877, [1.000, 0.117, 0.000]], [0.879, [1.000, 0.117, 0.000]], [0.881, [1.000, 0.102, 0.000]], [0.883, [1.000, 0.102, 0.000]], [0.885, [1.000, 0.088, 0.000]], [0.886, [1.000, 0.088, 0.000]], [0.888, [0.999, 0.073, 0.000]], [0.890, [0.999, 0.073, 0.000]], [0.892, [0.981, 0.059, 0.000]], [0.894, [0.981, 0.059, 0.000]], [0.896, [0.963, 0.044, 0.000]], [0.898, [0.963, 0.044, 0.000]], [0.900, [0.946, 0.030, 0.000]], [0.902, [0.946, 0.030, 0.000]], [0.904, [0.928, 0.015, 0.000]], [0.906, [0.928, 0.015, 0.000]], [0.908, [0.910, 0.001, 0.000]], [0.910, [0.910, 0.001, 0.000]], [0.912, [0.892, 0.000, 0.000]], [0.914, [0.892, 0.000, 0.000]], [0.916, [0.874, 0.000, 0.000]], [0.918, [0.874, 0.000, 0.000]], [0.920, [0.857, 0.000, 0.000]], [0.922, [0.857, 0.000, 0.000]], [0.924, [0.839, 0.000, 0.000]], [0.926, [0.839, 0.000, 0.000]], [0.928, [0.821, 0.000, 0.000]], [0.930, [0.821, 0.000, 0.000]], [0.932, [0.803, 0.000, 0.000]], [0.933, [0.803, 0.000, 0.000]], [0.935, [0.785, 0.000, 0.000]], [0.937, [0.785, 0.000, 0.000]], [0.939, [0.767, 0.000, 0.000]], [0.941, [0.767, 0.000, 0.000]], [0.943, [0.750, 0.000, 0.000]], [0.945, [0.750, 0.000, 0.000]], [0.947, [0.732, 0.000, 0.000]], [0.949, [0.732, 0.000, 0.000]], [0.951, [0.714, 0.000, 0.000]], [0.953, [0.714, 0.000, 0.000]], [0.955, [0.696, 0.000, 0.000]], [0.957, [0.696, 0.000, 0.000]], [0.959, [0.678, 0.000, 0.000]], [0.961, [0.678, 0.000, 0.000]], [0.963, [0.660, 0.000, 0.000]], [0.965, [0.660, 0.000, 0.000]], [0.967, [0.643, 0.000, 0.000]], [0.969, [0.643, 0.000, 0.000]], [0.971, [0.625, 0.000, 0.000]], [0.973, [0.625, 0.000, 0.000]], [0.975, [0.607, 0.000, 0.000]], [0.977, [0.607, 0.000, 0.000]], [0.978, [0.589, 0.000, 0.000]], [0.980, [0.589, 0.000, 0.000]], [0.982, [0.571, 0.000, 0.000]], [0.984, [0.571, 0.000, 0.000]], [0.986, [0.553, 0.000, 0.000]], [0.988, [0.553, 0.000, 0.000]], [0.990, [0.536, 0.000, 0.000]], [0.992, [0.536, 0.000, 0.000]], [0.994, [0.518, 0.000, 0.000]], [0.996, [0.518, 0.000, 0.000]], [0.998, [0.500, 0.000, 0.000]], [1.000, [0.500, 0.000, 0.000]]];
		function create_pulse_model(num_model) {
			const faceIndices = ['a', 'b', 'c', 'd'];
			const vertexColorMaterial = new THREE.MeshBasicMaterial(
				{
					vertexColors: THREE.VertexColors,
					side: THREE.DoubleSide,
					opacity: 0.95
				});
			let frame;
			for (t = 1; t <= total_frames[num_model] * 2; t += 2) {
				geometry = geometry_array[num_model][t - 1];
				for (k = 0; k < (segmentX); k++) {
					for (j = 0; j < (segmentY); j++) {
						geometry.vertices[(j) + ((segmentY) * k)].setZ(frame_info[t - 1][(j) + ((segmentY) * k)]);
					}
				}
				let color, point, face, numberOfSides, vertexIndex;
				let index = 0;
				let index_color;
				for (let i = 0; i < geometry.vertices.length; i++) {
					point = geometry.vertices[i];
					color = new THREE.Color(0xffffff);
					index = frame_color_info[t - 1][i];
					if (index < 0) {
						index = 0;
					}
					color.setRGB(jet[index][1][0], jet[index][1][1], jet[index][1][2]);
					geometry.colors[i] = color;
				}
				for (let i = 0; i < geometry.faces.length; i++) {
					face = geometry.faces[i];
					numberOfSides = (face instanceof THREE.Face3) ? 3 : 4;
					for (let j = 0; j < numberOfSides; j++) {
						vertexIndex = face[faceIndices[j]];
						face.vertexColors[j] = geometry.colors[vertexIndex];
					}
				}
				frame = new THREE.Mesh(geometry, vertexColorMaterial);
				frame.rotation.x -= Math.PI * 0.5;
				frame.scale.set(0.4, 0.4, 0.4);
				eval("obj" + num_model + "_" + Math.round(t / 2) + "= frame");
				eval("group" + num_model + ".add(obj" + num_model + "_" + Math.round(t / 2) + ")");
				eval("obj" + num_model + "_" + Math.round(t / 2) + ".visible = false;");
			}
		}
		var scan_ok = [0, 0, 0];
		function switchFrame(num_frame, num_model) {
			if (num_frame == 1) {
				eval("obj" + num_model + "_" + total_frames[num_model] + ".visible = false;");
				eval("obj" + num_model + "_" + num_frame + ".visible = true;");
			} else {
				eval("obj" + num_model + "_" + (num_frame - 1) + ".visible = false;");
				eval("obj" + num_model + "_" + num_frame + ".visible = true;");
			}
			if (num_frame == total_frames[num_model]) {
				num[num_model] = 0;
			}
			if (decode_ok[num_model]) {
				eval("ball_1D" + num_model + ".position.setX(" + num_frame * 2 + "* 0.05 - 2)");
				eval("ball_1D" + num_model + ".position.setY(C_y" + num_model + "[" + num_frame * 2 + "])");
				eval("ball_1D" + num_model + ".position.setZ(-C_z" + num_model + "[" + num_frame * 2 + "] + distance1DPulse)");
			}
		}
		var id = -1;
		var bufferCanvas = document.createElement('canvas');
		var bufferCtx = bufferCanvas.getContext('2d');
		var crop_index = 0.32;
		function cropImage(targetCanvas, topLeftX, topLeftY, topRightX, topRightY, bottomLeftX, bottomLeftY, bottomRightX, bottomRightY, flag, angle, str_tmp) {
			let x, y, width, height, _case, rotate_angle;
			if (topRightX > topLeftX && topRightY <= topLeftY && topLeftY < bottomLeftY && bottomLeftX >= topLeftX) {
				x = topLeftX;
				y = topLeftY;
				width = Math.sqrt(Math.pow((topRightX - topLeftX), 2) + Math.pow((topRightY - topLeftY), 2));
				height = Math.sqrt(Math.pow((bottomLeftX - topLeftX), 2) + Math.pow((bottomLeftY - topLeftY), 2));
				_case = 1;
				if (angle < -45) {
					x = topRightX;
					y = topRightY;
				} else {
				}
			}
			else if (topRightX <= topLeftX && topRightY < topLeftY && bottomLeftX > topLeftX && topLeftY >= bottomLeftY) {
				x = topRightX;
				y = topRightY;
				width = Math.sqrt(Math.pow((bottomRightX - bottomLeftX), 2) + Math.pow((bottomRightY - bottomLeftY), 2));
				height = Math.sqrt(Math.pow((bottomRightX - topRightX), 2) + Math.pow((bottomRightY - topRightY), 2));
				_case = 2;
				if (angle < 45) {
					x = bottomRightX;
					y = bottomRightY;
				} else {
				}
			}
			else if (topRightX < topLeftX && topRightY >= topLeftY && bottomLeftX <= topLeftX && topLeftY > bottomLeftY) {
				x = bottomRightX;
				y = bottomRightY;
				width = Math.sqrt(Math.pow((topLeftX - bottomLeftX), 2) + Math.pow((topLeftY - bottomLeftY), 2));
				height = Math.sqrt(Math.pow((bottomRightX - bottomLeftX), 2) + Math.pow((bottomRightY - bottomLeftY), 2));
				_case = 3;
				if (angle < -45) {
					x = bottomLeftX;
					y = bottomLeftY;
				} else {
				}
			}
			else {
				x = bottomLeftX;
				y = bottomLeftY;
				width = Math.sqrt(Math.pow((topRightX - topLeftX), 2) + Math.pow((topRightY - topLeftY), 2));
				height = Math.sqrt(Math.pow((bottomLeftX - topLeftX), 2) + Math.pow((bottomLeftY - topLeftY), 2));
				_case = 4;
				if (angle < 45) {
					x = topLeftX;
					y = topLeftY;
				} else {
				}
			}
			if (angle < 5 && angle > -5) {
				x = x + width * crop_index;
				y = y + height * crop_index;
				width = width * (1 - crop_index * 2);
				height = height * (1 - crop_index * 2);
			}
			let targetctx = targetCanvas.getContext('2d');
			bufferCanvas.width = width;
			bufferCanvas.height = height;
			bufferCtx.rect(0, 0, width, width);
			bufferCtx.fillStyle = 'white';
			bufferCtx.fill();
			bufferCtx.translate(width / 2, height / 2);
			bufferCtx.rotate((-angle + rotate_angle) * Math.PI / 180);
			bufferCtx.translate(-width / 2, -height / 2);
			bufferCtx.drawImage(targetCanvas, -x, -y);
			bufferCtx.rotate((angle - rotate_angle) * Math.PI / 180);
			document.getElementById(str_tmp).src = bufferCanvas.toDataURL('image/jpeg');
			document.getElementById(str_tmp).style.display = 'initial';
		}
		var code = ['', '', ''];
		var decode_ok = [0, 0, 0];
		var create_complete = [0, 0, 0];
		var artoolkitMarker = [];
		var markerRoot = [];
		markerRoot[0] = new THREE.Group();
		markerRoot[1] = new THREE.Group();
		markerRoot[2] = new THREE.Group();
		var video = document.getElementsByTagName('video')[0];
		var width;
		var height;
		var code_scan = function () {
			var self = this;
			self.data = '';
			self.location = '';
		};
		var points;
		function create_other_info(num_model, info_string) {
			generateText(num_model, info_string);
			let bool_left = (info_string[4].charAt(0)) == 'L' ? 1 : 0;
			generateHand(num_model, bool_left);
			let pos_depth_temp = info_string[4].split(" ");
			let pos_temp = pos_depth_temp[1];
			let depth_temp = pos_depth_temp[2];
			let pos_val, depth_val;
			switch (pos_temp) {
				case "Cun": pos_val = 0; break;
				case "Guan": pos_val = 1; break;
				case "Chi": pos_val = 2; break;
			}
			switch (depth_temp) {
				case "Light": depth_val = 0; break;
				case "Middle": depth_val = 1; break;
				case "Deep": depth_val = 2; break;
			}
			createVesselLine(pos_val, depth_val, num_model);
			const line = new MeshLine();
			line.setGeometry(points);
			let material = new MeshLineMaterial({
				useMap: false,
				color: new THREE.Color(0x006699),
				opacity: 1,
				resolution: resolution,
				sizeAttenuation: false,
				lineWidth: 3,
			});
			const curve = new THREE.Mesh(line, material);
			curve.position.z = distance1DPulse;
			curve.rotateX(-Math.PI * 3 / 4);
			eval("group" + num_model + ".add(curve);");
			const ballGeometry = new THREE.SphereGeometry(0.08, 32, 32);
			const ballMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
			eval("ball_1D" + num_model + " = new THREE.Mesh(ballGeometry, ballMaterial);");
			eval("ball_1D" + num_model + ".position.set(0, 0, distance1DPulse);");
			eval("ball_1D" + num_model + ".renderOrder = 1;");
			eval("group" + num_model + ".add(ball_1D" + num_model + ");");
			eval("C_y" + num_model + "= new Array(total_frames[" + num_model + "]*2);");
			eval("C_z" + num_model + "= new Array(total_frames[" + num_model + "]*2);");
			for (let i = 0; i < total_frames[num_model] * 2; i++) {
				eval("C_y" + num_model + "[i] = points[i*3+2] * Math.sqrt(2) / 2;");
				eval("C_z" + num_model + "[i] = C_y" + num_model + "[i];");
			}
		}
		function generateText(num_model, info_string) {
			loader.load('fonts/helvetiker_regular.typeface.json', function (font) {
				let arr_text = new Array('SZN', 'FINGER', 'POS', 'GNDR', 'AGE', 'BP', 'BMI', 'BPM', 'AIx');
				let BMI = "BMI:  " + info_string[1];
				let POS = "POS:  " + info_string[4];
				let GNDR = "GNDR:  " + info_string[3];
				let AGE = "AGE:  " + info_string[2];
				let BP = "BP:  " + info_string[0];
				let FINGER = "FINGER:  " + info_string[5];
				let SZN = "SZN:  " + info_string[6];
				let BPM = "BPM:  " + Math.round(3000 / (total_frames[num_model]));
				let AIx = "AIx:  " + code[num_model].data.split(';')[18];
				const matLite_blue = new THREE.MeshBasicMaterial({
					color: new THREE.Color(0x006699),
					transparent: true,
					opacity: 0.8,
					side: THREE.DoubleSide
				});
				const matLite_red = new THREE.MeshBasicMaterial({
					color: new THREE.Color(0xB0171F),
					transparent: true,
					opacity: 0.8,
					side: THREE.DoubleSide
				});
				const matLite_yellow = new THREE.MeshBasicMaterial({
					color: new THREE.Color(0xFFFF00),
					transparent: true,
					opacity: 0.8,
					side: THREE.DoubleSide
				});
				let shapes, geometry, mesh;
				for (let i = 0; i < arr_text.length; i++) {
					eval("shapes = font.generateShapes( " + arr_text[i] + " , 100 );");
					geometry = new THREE.ShapeBufferGeometry(shapes);
					switch (i) {
						case 0: //season
							mesh = new THREE.Mesh(geometry, matLite_blue);
							break;
						case 1: //finger
							mesh = new THREE.Mesh(geometry, matLite_blue);
							break;
						case 2: //pos
							mesh = new THREE.Mesh(geometry, matLite_blue);
							break;
						case 3: //gender
							mesh = new THREE.Mesh(geometry, matLite_blue);
							break;
						case 4: //age
							mesh = new THREE.Mesh(geometry, matLite_blue);
							break;
						case 5: //BP
							if (info_string[0] == "Normal") {
								mesh = new THREE.Mesh(geometry, matLite_blue);
							} else {
								mesh = new THREE.Mesh(geometry, matLite_red);
							}
							break;
						case 6: //BMI
							if (info_string[1] == "Normal") {
								mesh = new THREE.Mesh(geometry, matLite_blue);
							} else {
								mesh = new THREE.Mesh(geometry, matLite_red);
							} break;
						case 7: //BPM
							mesh = new THREE.Mesh(geometry, matLite_blue);
							break;
						case 8: //AIx
							mesh = new THREE.Mesh(geometry, matLite_blue);
							break;
						default:
							break;
					}
					mesh.position.set(1.5, 0, 4 + i * 0.5);
					mesh.rotateX(-Math.PI / 4);
					// mesh.rotateZ(Math.PI);
					mesh.scale.set(0.003, 0.003, 0.003);
					eval("group" + num_model + ".add(mesh);");
				}
			});
		}
		// hand picture
		// plane
		function generateHand(num_model, bool_left) {
			let texture;
			if (bool_left) {
				texture = new THREE.TextureLoader().load('leftHand_new.png');
			} else {
				texture = new THREE.TextureLoader().load('rightHand_new.png');
			}
			let geometry = new THREE.PlaneGeometry(500, 699);
			let material = new THREE.MeshBasicMaterial({ map: texture });
			material.transparent = true;
			let ldp = new THREE.Mesh(geometry, material);
			if (bool_left) {
				ldp.position.set(-1.5, -1, 4);
			} else {
				ldp.position.set(-1.55, -1, 4);
			}
			ldp.scale.set(0.005, 0.005, 0.005);
			ldp.rotateX(-Math.PI / 2);
			eval("group" + num_model + ".add(ldp);");
		}
		function createVessel(pos, depth, num_model) {
			let vesselGroup = new THREE.Group();
			let vesselPlaneGeo = new THREE.PlaneGeometry(1, 2, 2, 2);
			let vesselPointGeo = new THREE.CylinderGeometry(0.1 * (depth + 1), 0.1 * (depth + 1), 0.01, 20);
			let materialPlane = new THREE.MeshBasicMaterial({ color: 0x00ff00, opacity: 0.2, });
			let materialPoint = new THREE.MeshBasicMaterial({ color: 0xff0000, side: THREE.DoubleSide });
			let vesselPlane = new THREE.Mesh(vesselPlaneGeo, materialPlane);
			let vesselPoint = new THREE.Mesh(vesselPointGeo, materialPoint);
			vesselPoint.renderOrder = 1;
			vesselPlane.rotateX(-Math.PI / 2);
			vesselPoint.position.set(0, 0.2, pos * 0.5 - 0.5);
			vesselGroup.add(vesselPlane);
			vesselGroup.add(vesselPoint);
			vesselGroup.translateZ(3);
			vesselGroup.translateY(-1);
			vesselGroup.scale.set(0.5, 0.5, 0.5);
			eval("group" + num_model + ".add(vesselGroup);");
		}
		function createVesselLine(pos, depth, num_model) {
			let vesselLineGeometry = new THREE.Geometry();
			let vesselLineGeometry1 = new THREE.Geometry();
			let vesselLineGeometry2 = new THREE.Geometry();
			let vesselLineMaterial = new THREE.LineBasicMaterial({
				color: 0xFF0000
			});
			switch (depth) {
				case 2:
					{
						vesselLineGeometry.vertices.push(
							new THREE.Vector3(-1.35, -1, 0.5 + 0.25 * pos - 0.05),
							new THREE.Vector3(-1.7, -1, 0.5 + 0.25 * pos - 0.05)
						);
						let vesselLine = new THREE.Line(vesselLineGeometry, vesselLineMaterial);
						vesselLine.position.set(0, 0, 4);
						eval("group" + num_model + ".add(vesselLine);");
						vesselLineGeometry1.vertices.push(
							new THREE.Vector3(-1.35, -1, 0.5 + 0.25 * pos + 0.03),
							new THREE.Vector3(-1.7, -1, 0.5 + 0.25 * pos + 0.03)
						);
						vesselLine = new THREE.Line(vesselLineGeometry1, vesselLineMaterial);
						vesselLine.position.set(0, 0, 4);
						eval("group" + num_model + ".add(vesselLine);");
						vesselLineGeometry2.vertices.push(
							new THREE.Vector3(-1.35, -1, 0.5 + 0.25 * pos + 0.1),
							new THREE.Vector3(-1.7, -1, 0.5 + 0.25 * pos + 0.1)
						);
						vesselLine = new THREE.Line(vesselLineGeometry2, vesselLineMaterial);
						vesselLine.position.set(0, 0, 4);
						eval("group" + num_model + ".add(vesselLine);");
					}
					break;
				case 1:
					{
						vesselLineGeometry.vertices.push(
							new THREE.Vector3(-1.35, -1, 0.5 + 0.25 * pos),
							new THREE.Vector3(-1.7, -1, 0.5 + 0.25 * pos)
						);
						let vesselLine = new THREE.Line(vesselLineGeometry, vesselLineMaterial);
						vesselLine.position.set(0, 0, 4);
						eval("group" + num_model + ".add(vesselLine);");
						vesselLineGeometry1.vertices.push(
							new THREE.Vector3(-1.35, -1, 0.5 + 0.25 * pos + 0.05),
							new THREE.Vector3(-1.7, -1, 0.5 + 0.25 * pos + 0.05)
						);
						vesselLine = new THREE.Line(vesselLineGeometry1, vesselLineMaterial);
						vesselLine.position.set(0, 0, 4);
						eval("group" + num_model + ".add(vesselLine);");
					}
					break;
				case 0:
					{
						vesselLineGeometry.vertices.push(
							new THREE.Vector3(-1.35, -1, 0.5 + 0.25 * pos),
							new THREE.Vector3(-1.7, -1, 0.5 + 0.25 * pos)
						);
						let vesselLine = new THREE.Line(vesselLineGeometry, vesselLineMaterial);
						vesselLine.position.set(0, 0, 4);
						eval("group" + num_model + ".add(vesselLine);");
					}
					break;
				default:
					break;
			}
		}
		var worker = new Worker('jsQR_worker.js');
		var workerReady = true;
		var worker2 = new Worker('jsQR_worker.js');
		var workerReady2 = true;
		function angle(start, end) {
			var diff_x = end.x - start.x,
				diff_y = end.y - start.y;
			return 360 * Math.atan(diff_y / diff_x) / (2 * Math.PI);
		}
		let current = 0;
		let start_loop = false;
		function scan2model() {
			if (workerReady) {
				let scanedImageData = arToolkitContext.arController.ctx.getImageData(0, 0, width, height);
				worker.postMessage(scanedImageData, [scanedImageData.data.buffer]);
				workerReady = false;
			}
			worker.onmessage = function (event) {
				console.log("here in the scan thing");
				workerReady = true;
				let code_scan;
				if (event.data == "NothingDetected") {
					code_scan = null;
				}
				else {
					let str_temp = event.data.data;
					if (str_temp.indexOf('?') != -1) {
						str_temp = str_temp.split("?")[1];
					}
					code_scan = event.data;
					code_scan.data = str_temp;
				}
				if (code_scan != null) {
					if (code_scan.data.indexOf(";") != -1) {
						if (start_loop) {
							let is_exist = false;
							for (let i = 0; i <= 2; i++) {
								if (code_scan.data == code[i].data) {
									is_exist = true;
									break;
								}
							}
							if (!is_exist) {
								// replace the qrCode.
								let num_marker = arToolkitContext.arController.getMarkerNum();
								for (let j = 0; j < num_marker; j++) {
									markerInfo = arToolkitContext.arController.getMarker(j);
									if (markerInfo.id === 8191) {
										return;
									}
								}
								code[current] = code_scan;
								scan_ok[current] = 1;
								decode_ok[current] = 0;
								create_complete[current] = 0;
								eval("scene.remove(markerRoot[current]);");
								eval("markerRoot[current].remove(group" + current + ");");
								eval("group" + current + " = new THREE.Group;");
								create_empty_geometry(current);
								decodeFlag[current] = true;
								let _angle = angle({ x: code[current].location.topLeftCorner.x, y: code[current].location.topLeftCorner.y },
									{ x: code[current].location.topRightCorner.x, y: code[current].location.topRightCorner.y });
								let str_tmp = 'source' + (current + 1).toString();
								cropImage(arToolkitContext.arController.canvas, code[current].location.topLeftCorner.x, code[current].location.topLeftCorner.y,
									code[current].location.topRightCorner.x, code[current].location.topRightCorner.y,
									code[current].location.bottomLeftCorner.x, code[current].location.bottomLeftCorner.y,
									code[current].location.bottomRightCorner.x, code[current].location.bottomRightCorner.y, false, _angle, str_tmp);
								w = new Worker("create_model_jshaman2.js");
								w.onmessage = function (event) {
									if (event.data.frame_info != null) {
										total_frames[event.data.current] = event.data.total_frames / 2;
										frame_info = event.data.frame_info;
										frame_color_info = event.data.frame_color_info;
										points = event.data.points;
										create_pulse_model(event.data.current);
										create_complete[event.data.current] = 1;
										w.terminate();
									}
								}
								w.postMessage({
									code: code[current].data,
									num: current,
									zFactor: zFactor,
									resolution: resolution
								});
								if (current == 2) {
									current = 0;
								} else {
									current++;
								}
							}
						} else {
							// not in a loop.
							let is_exist = false;
							for (let i = 0; i < current; i++) {
								if (code_scan.data == code[i].data) {
									is_exist = true;
									break;
								}
							}
							if (!is_exist) {
								let num_marker = arToolkitContext.arController.getMarkerNum();
								for (let j = 0; j < num_marker; j++) {
									markerInfo = arToolkitContext.arController.getMarker(j);
									if (markerInfo.id === 8191) {
										return;
									}
								}
								code[current] = code_scan;
								scan_ok[current] = 1;
								let _angle = angle({ x: code[current].location.topLeftCorner.x, y: code[current].location.topLeftCorner.y },
									{ x: code[current].location.topRightCorner.x, y: code[current].location.topRightCorner.y });
								let str_tmp = 'source' + (current + 1).toString();
								cropImage(arToolkitContext.arController.canvas, code[current].location.topLeftCorner.x, code[current].location.topLeftCorner.y,
									code[current].location.topRightCorner.x, code[current].location.topRightCorner.y,
									code[current].location.bottomLeftCorner.x, code[current].location.bottomLeftCorner.y,
									code[current].location.bottomRightCorner.x, code[current].location.bottomRightCorner.y, false, _angle, str_tmp);
								w = new Worker("create_model_jshaman2.js");
								w.onmessage = function (event) {
									if (event.data.frame_info != null) {
										total_frames[event.data.current] = event.data.total_frames / 2;
										frame_info = event.data.frame_info;
										frame_color_info = event.data.frame_color_info;
										points = event.data.points;
										create_pulse_model(event.data.current);
										create_complete[event.data.current] = 1;
										w.terminate();
									}
								}
								w.postMessage({
									code: code[current].data,
									num: current,
									zFactor: zFactor,
									resolution: resolution
								});
								if (current == 2) {
									start_loop = true;
									current = 0;
								} else {
									current++;
								}
							}
						}
					}

				}
			}
		}
		// try to create model at the first time!
		console.log("param", param);
		if (param != "") {
			code[current] = code_scan;
			code[current].data = param;
			scan_ok[current] = 1;
			w = new Worker("create_model_jshaman2.js");
			w.onmessage = function (event) {
				if (event.data.frame_info != null) {
					total_frames[event.data.current] = event.data.total_frames / 2;
					frame_info = event.data.frame_info;
					frame_color_info = event.data.frame_color_info;
					points = event.data.points;
					create_pulse_model(event.data.current);
					create_complete[event.data.current] = 1;
					w.terminate();
				}
			}
			w.postMessage({
				code: code[current].data,
				num: current,
				zFactor: zFactor,
				resolution: resolution
			});
			current++;
		}
		let decodeFlag = [true, true, true];
		function decode2marker() {
			if (workerReady2) {
				let scanedImageData = arToolkitContext.arController.ctx.getImageData(0, 0, width, height);
				worker2.postMessage(scanedImageData, [scanedImageData.data.buffer]);
				workerReady2 = false;
			}
			worker2.onmessage = function (event) {
				workerReady2 = true;
				if (current > 0 && !create_complete[current - 1]) {
					return;
				}
				let code_tmp;
				if (event.data == "NothingDetected") {
					code_tmp = null;
				}
				else {
					let str_temp = event.data.data;
					if (str_temp.indexOf('?') != -1) {
						str_temp = str_temp.split("?")[1];
					}
					code_tmp = event.data;
					code_tmp.data = str_temp;
				}
				if (code_tmp != null) {
					for (let i = 0; i < 3; i++) {
						if (decodeFlag[i] && code[i] !== '' && code_tmp.data == code[i].data) {
							let str_tmp = 'source' + (i + 1).toString();
							code[i] = code_tmp;
							let _angle = angle({ x: code[i].location.topLeftCorner.x, y: code[i].location.topLeftCorner.y },
								{ x: code[i].location.topRightCorner.x, y: code[i].location.topRightCorner.y });
							cropImage(arToolkitContext.arController.canvas, code[i].location.topLeftCorner.x, code[i].location.topLeftCorner.y,
								code[i].location.topRightCorner.x, code[i].location.topRightCorner.y,
								code[i].location.bottomLeftCorner.x, code[i].location.bottomLeftCorner.y,
								code[i].location.bottomRightCorner.x, code[i].location.bottomRightCorner.y, false, _angle, str_tmp);
							let img = document.getElementById(str_tmp);
							arToolkitContext.arController.detectMarker(bufferCanvas);
							num_marker = arToolkitContext.arController.getMarkerNum();
							for (let j = 0; j < num_marker; j++) {
								markerInfo = arToolkitContext.arController.getMarker(j);
								if (markerInfo.id != -1 && markerInfo.id != 7099 && markerInfo.id != 8191) {
									let resString = decode(markerInfo.id);
									decode_ok[i] = 1;
									scene.add(markerRoot[i]);
									artoolkitMarker[i] = new THREEx.ArMarkerControls(arToolkitContext, markerRoot[i], {
										type: 'barcode',
										barcodeValue: markerInfo.id,
										smooth: true,
										smoothCount: 5,
										smoothTolerance: 0.01,
										smoothThreshold: 2
									});
									barcode_group[i] = markerInfo.id;
									eval("scene.remove(group" + 0 + ");");
									eval("markerRoot[i].add(group" + i + ");");
									if (i == 0 && param != "" && !start_loop) {
										eval("group" + i + ".position.set(0, 0, 0)");
										eval("group" + i + ".rotation.x -= Math.PI / 8");
										eval("group" + i + ".rotation.y -= Math.PI / 6");
									}
									let info_string = decode(markerInfo.id);
									create_other_info(i, info_string);
									decodeFlag[i] = false;
									break;
								}
							}
						}
					}
				}
			}
		}
		// try to decode other info at the first time!
		if (param != "") {
			decode_ok[0] = 0;
			group0.position.set(0, 0, -20);
			group0.rotation.x += Math.PI / 8;
			group0.rotation.y += Math.PI / 6;
			eval("scene.add(group" + 0 + ");");
			decodeFlag[i] = true;
		}

		var decode = function (res) {
			let binaryRes = res.toString(2)
			binaryRes = (Array(13).join('0') + parseInt(binaryRes)).slice(-13);
			binaryRes = binaryRes.split("").reverse().join("");
			const seasonLen = 2;
			const fingerLen = 1;
			const leftLen = 1;
			const posDepthLen = 3;
			const genderLen = 1;
			const ageLen = 2;
			const bPBMILEN = 3;
			const binaryLenArray = [bPBMILEN, ageLen, genderLen, posDepthLen, leftLen, fingerLen, seasonLen];
			const seasons = ["Spring", "Summer", "Autumn", "Winter"];
			const fingers = ["One", "Simultaneous"];
			const lefts = ["Left", "Right"];
			const posDepths = ["Cun Middle", "Cun Light", "Cun Deep", "Guan Light", "Guan Middle", "Guan Deep", "Chi Light", "Chi Middle"];
			const genders = ["Male", "Female"];
			const ages = ["Immaturity", "Adult", "Senior Adult"];
			const bPBMIs = ["Low Low", "Low Normal", "Low Overweight", "Normal Low", "Normal Normal", "Normal Overweight", "High Low", "High Normal"];
			const ageBPBMIPosDepths = [
				"Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Middle", "Immaturity High Overweight Cun Deep", "Immaturity High Overweight Guan Light",
				"Immaturity High Overweight Guan Middle", "Immaturity High Overweight Guan Deep", "Immaturity High Overweight Chi Light", "Immaturity High Overweight Chi Middle",
				"Immaturity Low Low Chi Deep", "Immaturity Low Normal Chi Deep", "Immaturity Low Overweight Chi Deep", "Immaturity Normal Low Chi Deep",
				"Immaturity Normal Normal Chi Deep", "Immaturity Normal Overweight Chi Deep", "Immaturity High Low Chi Deep", "Immaturity High Normal Chi Deep",
				"Immaturity High Overweight Chi Deep",
				"Adult High Overweight Cun Light", "Adult High Overweight Cun Middle", "Adult High Overweight Cun Deep", "Adult High Overweight Guan Light",
				"Adult High Overweight Guan Middle", "Adult High Overweight Guan Deep", "Adult High Overweight Chi Light", "Adult High Overweight Chi Middle",
				"Adult Low Low Chi Deep", "Adult Low Normal Chi Deep", "Adult Low Overweight Chi Deep", "Adult Normal Low Chi Deep",
				"Adult Normal Normal Chi Deep", "Adult Normal Overweight Chi Deep", "Adult High Low Chi Deep", "Adult High Normal Chi Deep",
				"Adult High Overweight Chi Deep",
				"Senior Adult High Overweight Cun Light", "Senior Adult High Overweight Cun Middle", "Senior Adult High Overweight Cun Deep", "Senior Adult High Overweight Guan Light",
				"Senior Adult High Overweight Guan Middle", "Senior Adult High Overweight Guan Deep", "Senior Adult High Overweight Chi Light", "Senior Adult High Overweight Chi Middle",
				"Senior Adult Low Low Chi Deep", "Senior Adult Low Normal Chi Deep", "Senior Adult Low Overweight Chi Deep", "Senior Adult Normal Low Chi Deep",
				"Senior Adult Normal Normal Chi Deep", "Senior Adult Normal Overweight Chi Deep", "Senior Adult High Low Chi Deep", "Senior Adult High Normal Chi Deep",
				"Senior Adult High Overweight Chi Deep",
				"Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light",
				"Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light",
				"Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light", "Immaturity High Overweight Cun Light",
				"Immaturity High Overweight Cun Light"
			];
			let season, finger, left, posDepth, gender, age, bPBMI;
			let parameters = [bPBMI, age, gender, posDepth, left, finger, season];
			let binaryParameters = [];
			const parametersEnum = [bPBMIs, ages, genders, posDepths, lefts, fingers, seasons];
			let ans = [];
			for (let i = 0; i < binaryLenArray.length; i++) {
				parameters[i] = binaryRes.slice(0, binaryLenArray[i]).split("").reverse().join("");
				binaryParameters.push(parameters[i]);
				binaryRes = binaryRes.slice(binaryLenArray[i]);
				if (i === 0) {
					let str = parametersEnum[i][parseInt(parameters[i], 2)].split(" ");
					ans.push(str[0]);
					ans.push(str[1]);
				}
				else if (i === 4) {
					let str = ans.pop();
					ans.push(parametersEnum[i][parseInt(parameters[i], 2)] + " " + str);
				}
				else {
					ans.push(parametersEnum[i][parseInt(parameters[i], 2)]);
				}
			}
			if (binaryParameters[1] === "11") {
				let str = ageBPBMIPosDepths[parseInt(binaryParameters[0] + binaryParameters[3], 2)];
				let strArray = str.split(" ");
				if (strArray.length === 5) {
					ans[0] = strArray[1];
					ans[1] = strArray[2];
					ans[2] = strArray[0];
					let posDepthArray = ans[4].split(" ");
					ans[4] = posDepthArray[0] + " " + strArray[3] + " " + strArray[4];
				}
				else {
					ans[0] = strArray[2];
					ans[1] = strArray[3];
					ans[2] = strArray[0] + " " + strArray[1];
					let posDepthArray = ans[4].split(" ");
					ans[4] = posDepthArray[0] + " " + strArray[4] + " " + strArray[5];
				}
			}
			return ans;
		};
		var slow_dowm_scan = 0;
		var setSize = 0;
		var d, newd, accnewd, accd, di;
		var slow_dowm_show = 0;
		var enable_slow_show = 0;
		var tick = function () {
			if (!setSize) {
				video = document.getElementsByTagName('video')[0];
				if (video.videoWidth == 0) return;
				width = video.videoWidth;
				height = video.videoHeight;
				bufferCanvas.width = width;
				bufferCanvas.height = height;
				setSize = 1;
			}
			if (!slow_dowm_show) {
				if (create_complete[0]) {
					if (!enable_slow_show) {
						if (num[0] == 1) {
							d = new Date();
						} else if (num[0] == 2) {
							newd = new Date();
							accnewd = Number(String(newd.getSeconds()) + "." + String(newd.getMilliseconds()));
							accd = Number(String(d.getSeconds()) + "." + String(d.getMilliseconds()));
							di = accnewd - accd;
							if (d.getMinutes() != newd.getMinutes()) {
								di = (60 * (newd.getMinutes() - d.getMinutes())) + di
							}
							if (Math.abs(Math.round(di * 1000) / 1000) < 0.02) {
								enable_slow_show = 1;
							}
						}
					}
					switchFrame(num[0], 0);
					num[0]++;
				}
				if (create_complete[1]) {
					switchFrame(num[1], 1);
					num[1]++;
				}
				if (create_complete[2]) {
					switchFrame(num[2], 2);
					num[2]++;
				}
			}
			if (enable_slow_show) {
				slow_dowm_show++;
				if (slow_dowm_show == 3) {
					slow_dowm_show = 0;
				}
			}
		};
		onRenderFcts.push(function (delta) {
			if (!scan_or_show) {
				if (!slow_dowm_scan) {
					scan2model();
					decode2marker();
				}
			}
			slow_dowm_scan++;
			if (slow_dowm_scan == 10) {
				slow_dowm_scan = 0;
			}
		})
		onRenderFcts.push(function (delta) {
			tick();
		})
		onRenderFcts.push(function () {
			renderer.render(scene, camera);
			controls.update();
		});
		var lastTimeMsec = null
		requestAnimationFrame(function animate(nowMsec) {
			requestAnimationFrame(animate);
			lastTimeMsec = lastTimeMsec || nowMsec - 1000 / 60
			var deltaMsec = Math.min(200, nowMsec - lastTimeMsec)
			lastTimeMsec = nowMsec
			onRenderFcts.forEach(
				function (onRenderFct) {
					onRenderFct(deltaMsec / 1000, nowMsec / 1000)
				})
		})
	</script>
</body>

</html>
